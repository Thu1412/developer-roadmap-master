import{j as u}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.DatCARk7.js";import{_ as b}from"./preload-helper.sN6dSm8X.js";/* empty css                       */import{r as j,u as D,a as C,b as I,c as P}from"./resource-progress.CNHeJjXc.js";import{p as w}from"./page.DyYQD7MX.js";import{u as T}from"./use-toast.BdCcSTJE.js";import{s as _}from"./slugger.rj1cS6co.js";import{i as h}from"./jwt.1xGNZsvU.js";import{s as v}from"./popup.CdCAhVM2.js";import{S as N}from"./Spinner.CPY-6wbR.js";import{b as G}from"./http.qJhOBTpO.js";import{g as $}from"./browser.3c2kCsRM.js";import{R as A}from"./RoadmapFloatingChat.CTox2nJW.js";import"./js.cookie.Cz0CWeBA.js";import"./roadmap.DwTTnFhR.js";import"./index.BHh4vvK5.js";import"./index.3whys8t3.js";import"./query-client.BXTfwa3d.js";import"./query-http.YhxTqNi8.js";import"./fp.esm.D_pnqQn4.js";import"./toast.DlejBBdi.js";/* empty css                                 */import"./useQuery.BDS8a8wn.js";import"./index.Cfv66hal.js";import"./index.Bz-QvCnq.js";import"./use-keydown.UQ-VttR1.js";import"./classname.y9b8gBZq.js";import"./dom.B_TnKQIa.js";import"./ai-course.C9pe4RQ2.js";import"./billing.CdvAGjKR.js";import"./UpdatePersonaModal.DHq1e2hk.js";import"./createLucideIcon.uNyFMN5K.js";import"./Popover.BEqRNE7W.js";import"./Combination.DIpUOS19.js";import"./floating-ui.dom.BG6dflv2.js";import"./markdown.BXNIcYB9.js";/* empty css                                 */import"./use-copy-text.DMdbdIxo.js";import"./Tooltip.BP6rWEsy.js";import"./check.DCsIB_xO.js";import"./copy.IVh-7Rp7.js";import"./Modal.B1RqXaQs.js";import"./use-outside-click.f1LA7r1K.js";import"./x.ZVxf9pxD.js";import"./useMutation.BrRqCquH.js";import"./loader-circle.1OH4z0ap.js";import"./message-circle.gi35PKdE.js";import"./ai.CwFQCDSa.js";import"./datetime.BHfGb2kO.js";import"./DropdownMenu.CS77xgrA.js";import"./chevron-right.CrKPBoyZ.js";import"./ellipsis-vertical.CxxBP93e.js";import"./trash-2.B2o931ei.js";import"./use-debounce.2NG_dkht.js";import"./search.D49NcfKq.js";import"./CheckIcon.D4OhQ5l1.js";import"./lock.C0iyFeE_.js";import"./roadmap.C9m-s_nC.js";import"./index.BgRaT1MR.js";import"./chevron-down.C3HM4CLF.js";import"./UpgradeAccountModal.Bf1PhEwX.js";import"./UpdatePlanConfirmation.vVGIG51-.js";import"./VerifyUpgrade.DHdhu0dP.js";import"./circle-check-big.DD4Bg2zr.js";import"./zap.W9oJWPBR.js";import"./map.D6boQwTM.js";import"./TopicDetail.0rOhIF79.js";import"./GitHubIcon.NZCYHAdm.js";import"./vue.Bx8V6p_T.js";import"./transition.MUZrSsh7.js";import"./wand-sparkles.DH_Id-ff.js";import"./number.al1uMBuK.js";import"./AILimitsPopup.IBd1xV7_.js";import"./gift.ZPnr9qou.js";import"./star.efkPFH5L.js";import"./book-open-text.DUZ-qSpq.js";import"./brain.t8-WSjRY.js";import"./CodeBlock.DM3RYXoM.js";import"./index.zZad4t7S.js";import"./user-round.BP1hNqEM.js";import"./bot.BOh-sxCh.js";import"./send.CNwPxIps.js";import"./file-text.QnmHb0pX.js";import"./heart-handshake.D70r9b2H.js";import"./use-auth.Bw1nhFr_.js";import"./share.Ho6hSRxU.js";import"./book-open.D6AjheEV.js";import"./plus.CQTVuaoH.js";import"./person-standing.JwgQFf2-.js";const B=a.lazy(()=>b(()=>import("./index.BgRaT1MR.js"),[]).then(m=>({default:m.Renderer})));function x(m){const e=m?.closest("g")||{},l=e?.dataset?.nodeId,p=e?.dataset?.type,i=e?.dataset?.title;return!l||!p?null:{nodeId:l,nodeType:p,targetGroup:e,title:i}}const L=["topic","subtopic","button","link-item","resourceButton","todo","todo-checkbox","checklist-item"];function K(m){const{resourceId:e,nodes:l=[],edges:p=[]}=m,i=a.useRef(null),y=T();async function c(t,n){w.set("Updating progress"),D({resourceId:e,resourceType:"roadmap",topicId:t},n).then(()=>{C(t,n)}).catch(o=>{y.error("Something went wrong, please try again."),console.error(o)}).finally(()=>{w.set(""),I()})}const R=a.useCallback(t=>{const n=t.target,{nodeId:o,nodeType:r,targetGroup:s,title:f}=x(n)||{};if(!o||!r||!L.includes(r))return;if(r==="button"||r==="link-item"||r==="resourceButton"){const d=s?.dataset?.link||"";d.startsWith("http")?window.open(d,"_blank"):window.location.href=d;return}const k=s?.classList.contains("learning"),E=s?.classList.contains("skipped");if(r==="todo-checkbox"){if(t.preventDefault(),!h()){v();return}const d=s?.classList.contains("done")?"pending":"done";c(o,d);return}if(t.shiftKey){if(t.preventDefault(),!h()){v();return}c(o,k?"pending":"learning");return}else if(t.altKey){if(t.preventDefault(),!h()){v();return}c(o,E?"pending":"skipped");return}if(r==="checklist-item"&&n.tagName==="rect"){if(t.preventDefault(),!h()){v();return}const d=s?.classList.contains("done")?"pending":"done";c(o,d);return}if(r==="checklist-item"||!f)return;const S=`${_(f)}@${o}`;window.dispatchEvent(new CustomEvent("roadmap.node.click",{detail:{topicId:S,resourceId:e,resourceType:"roadmap"}}))},[]),g=a.useCallback(t=>{t.preventDefault();const n=t.target,{nodeId:o,nodeType:r,targetGroup:s}=x(n)||{};if(!o||!r||!L.includes(r)||r==="button")return;if(!h()){v();return}const f=s?.classList.contains("done");c(o,f?"pending":"done")},[]);return a.useEffect(()=>{if(i?.current)return i?.current?.addEventListener("click",R),i?.current?.addEventListener("contextmenu",g),()=>{i?.current?.removeEventListener("click",R),i?.current?.removeEventListener("contextmenu",g)}},[]),u.jsx(B,{ref:i,roadmap:{nodes:l,edges:p},onRendered:()=>{i.current?.setAttribute("data-renderer","editor"),j("roadmap",e).finally()}})}function Lr(m){const{resourceId:e,resourceType:l="roadmap",dimensions:p,hasChat:i=!0}=m,[y,c]=a.useState(!1),[R,g]=a.useState(!0),[t,n]=a.useState(void 0),o=async()=>{g(!0);const{r:s}=$(),{response:f,error:k}=await G(`https://api.roadmap.sh/v1-official-roadmap/${s||e}`);if(k){console.error(k);return}n(f),g(!1),c(!!s)};a.useEffect(()=>{P(l,e),o().finally()},[e]);const r=p.width/p.height;return!t||R?u.jsx("div",{style:y?void 0:{"--aspect-ratio":r},className:"mt-5 flex aspect-[var(--aspect-ratio)] w-full flex-col justify-center",children:u.jsx("div",{className:"flex w-full justify-center",children:u.jsx(N,{className:"h-6 w-6 animate-spin sm:h-12 sm:w-12",isDualRing:!1})})}):u.jsxs("div",{style:y?void 0:{"--aspect-ratio":r},className:"mt-5 flex aspect-[var(--aspect-ratio)] w-full flex-col justify-center",children:[u.jsx(K,{...t,dimensions:p,resourceId:e}),i&&u.jsx(A,{roadmapId:e})]})}export{Lr as EditorRoadmap};
