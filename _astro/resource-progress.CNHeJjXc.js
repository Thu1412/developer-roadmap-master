import{a as w}from"./js.cookie.Cz0CWeBA.js";import{h as A,b as x}from"./http.qJhOBTpO.js";import{i as C,T as R,g as M}from"./jwt.1xGNZsvU.js";import{r as E,t as T}from"./roadmap.DwTTnFhR.js";import{q as I,a as P}from"./query-client.BXTfwa3d.js";import{h as _}from"./query-http.YhxTqNi8.js";function z(e,t){return I({queryKey:["resource-progress",t,e],queryFn:()=>_("/v1-get-user-resource-progress",{resourceId:t,resourceType:e}),enabled:!!C(),refetchOnMount:!1})}async function F(e){const{topicId:t,resourceType:o,resourceId:r}=e,{done:n=[]}=await g(o,r)||{};return n?.includes(t)}async function Q(e){const{topicId:t,resourceType:o,resourceId:r}=e,n=await g(o,r);return n?.done?.includes(t)?"done":n?.learning?.includes(t)?"learning":n?.skipped?.includes(t)?"skipped":"pending"}async function U(e,t){const{topicId:o,resourceType:r,resourceId:n}=e,{response:s,error:a}=await A("https://api.roadmap.sh/v1-update-resource-progress",{topicId:o,resourceType:r,resourceId:n,progress:t});if(a||!s?.done||!s?.learning)throw new Error(a?.message||"Something went wrong");return E.set({done:s.done,learning:s.learning,skipped:s.skipped,personalized:s.personalized}),P.setQueryData(z(r,n).queryKey,i=>{if(i)return{...i,done:s.done,learning:s.learning,skipped:s.skipped}}),s}function J(e,t){if(!["frontend","backend","devops","data-analyst","android","full-stack","ai-data-scientist","postgresql-dba","blockchain","qa","software-architect","cyber-security","ux-design","game-developer","server-side-game-developer","technical-writer","mlops","computer-science","react","vue","javascript","angular","nodejs","typescript","python","sql","system-design","aspnet-core","java","cpp","docker","prompt-engineering","aws","datastructures-and-algorithms","kubernetes","linux","software-design-architecture","rust","react-native","graphql","spring-boot","mongodb","flutter","design-system","golang"].includes(t))return;const r=M()?.id;if(!r)return;const n=`${e}-${t}-${r}-progress`,s=`${e}-${t}-${r}-cleared`,a=parseInt(localStorage.getItem(s)||"0",10);a>=10||(localStorage.removeItem(n),localStorage.setItem(s,`${a+1}`))}async function g(e,t){if(!w.get(R))return{done:[],learning:[],skipped:[],personalized:{topicIds:[],information:""}};const{response:o,error:r}=await x("https://api.roadmap.sh/v1-get-user-resource-progress",{resourceType:e,resourceId:t});return r||!o?(console.error(r),{done:[],learning:[],skipped:[],personalized:{topicIds:[],information:""}}):(E.set({done:o.done,learning:o.learning,skipped:o.skipped,personalized:o.personalized}),window.dispatchEvent(new CustomEvent("mark-favorite",{detail:{resourceType:e,resourceId:t,isFavorite:o.isFavorite}})),o)}function K(e,t=document){const o=[];return t.querySelectorAll(`[data-group-id$="-${e}"]`).forEach(r=>{const n=r?.dataset?.groupId||"";new RegExp(`^\\d+-${e}$`).test(n)&&o.push(r)}),d([`[data-group-id="${e}"]`,`[data-group-id="check:${e}"]`,`[data-node-id="${e}"]`,`[data-id="${e}"]`,`[data-checklist-checkbox][data-checklist-id="${e}"]`,`[data-checklist-label][data-checklist-id="${e}"]`],t).forEach(r=>{o.push(r)}),o}function l(e,t){const o=t==="learning",r=t==="skipped",n=t==="done",s=t==="removed";K(e).forEach(i=>{n?(i.classList.add("done"),i.classList.remove("learning","skipped")):o?(i.classList.add("learning"),i.classList.remove("done","skipped")):r?(i.classList.add("skipped"),i.classList.remove("done","learning")):s?(i.classList.add("removed"),i.classList.remove("done","learning","skipped")):i.classList.remove("done","skipped","learning","removed")})}async function V(e,t){const{done:o=[],learning:r=[],skipped:n=[],personalized:s={topicIds:[],information:""}}=await g(e,t)||{};o.forEach(a=>{l(a,"done")}),r.forEach(a=>{l(a,"learning")}),n.forEach(a=>{l(a,"skipped")}),s.topicIds.forEach(a=>{l(a,"skipped")}),O()}function d(e,t=document){const o=[];return e.forEach(r=>{t.querySelectorAll(r).forEach(n=>{o.push(n)})}),o}function O(){const e=document.querySelectorAll("[data-progress-nums-container]"),t=document.querySelectorAll("[data-progress-nums]");if(e.length===0||t.length===0)return;const o=d([".clickable-group",'[data-type="todo"]','[data-type="topic"]','[data-type="checklist-item"]','[data-type="subtopic"]',".react-flow__node-topic",".react-flow__node-subtopic"]).length,r=document.querySelectorAll('[data-group-id^="ext_link:"]').length,n=document.querySelectorAll('[data-group-id^="json:"]').length,s=document.querySelectorAll('[data-group-id^="check:"]').length,a=document.querySelectorAll('[data-group-id^="check:"].done').length,i=document.querySelectorAll('[data-type="todo-checkbox"].done').length,q=document.querySelectorAll('[data-group-id^="check:"].learning').length,S=document.querySelectorAll('[data-group-id^="check:"].skipped').length,$=document.querySelectorAll(".clickable-group.removed").length,p=o-r-n-s-$;T.set(p);const h=d(['.clickable-group.done:not([data-group-id^="ext_link:"])',"[data-node-id].done","[data-id].done"]).length-a-i,b=d([".clickable-group.learning","[data-node-id].learning","[data-id].learning"]).length-q,u=d([".clickable-group.skipped","[data-node-id].skipped","[data-id].skipped"]).length-S,m=document.querySelectorAll("[data-progress-done]");m.length>0&&m.forEach(c=>{c.innerHTML=`${h+u}`});const f=document.querySelectorAll("[data-progress-learning]");f.length>0&&f.forEach(c=>c.innerHTML=`${b}`);const k=document.querySelectorAll("[data-progress-skipped]");k.length>0&&k.forEach(c=>c.innerHTML=`${u}`);const y=document.querySelectorAll("[data-progress-total]");y.length>0&&y.forEach(c=>c.innerHTML=`${p}`);const L=Math.round((h+u)/p*100)||0,v=document.querySelectorAll("[data-progress-percentage]");v.length>0&&v.forEach(c=>c.innerHTML=`${L}`),e.forEach(c=>c.classList.remove("striped-loader")),t.forEach(c=>{c.classList.remove("opacity-0")})}export{l as a,O as b,J as c,z as d,Q as g,F as i,V as r,K as t,U as u};
