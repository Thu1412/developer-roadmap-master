import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.DatCARk7.js";import{O as A}from"./index.gjAxZpWu.js";/* empty css                       */import{u as D}from"./use-outside-click.f1LA7r1K.js";import{u as H}from"./use-keydown.UQ-VttR1.js";import{b as v}from"./http.qJhOBTpO.js";import{t as S}from"./resource-progress.CNHeJjXc.js";import{g as J,d as L}from"./browser.3c2kCsRM.js";import{u as O}from"./use-auth.Bw1nhFr_.js";import{M as F}from"./ModalLoader.BJqnisCv.js";import{renderFlowJSON as G}from"./index.BgRaT1MR.js";import{X as _}from"./x.ZVxf9pxD.js";import"./js.cookie.Cz0CWeBA.js";import"./fp.esm.D_pnqQn4.js";import"./jwt.1xGNZsvU.js";import"./roadmap.DwTTnFhR.js";import"./index.BHh4vvK5.js";import"./index.3whys8t3.js";import"./query-client.BXTfwa3d.js";import"./query-http.YhxTqNi8.js";import"./ErrorIcon.BTBCVae1.js";import"./Spinner.CPY-6wbR.js";import"./createLucideIcon.uNyFMN5K.js";function z(g){const{isLoading:a,progressResponse:n}=g,j=n?.user,l=n?.progress,i=l?.total||0,r=l?.done?.length||0,m=l?.skipped?.length||0,u=Math.round((r+m)/i*100)||0,b=l?.learning?.length||0;return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-5 mt-0 min-h-[28px] text-left sm:text-center md:mt-4 md:h-[60px]",children:[e.jsxs("h2",{className:"mb-1 text-lg font-bold md:text-2xl",children:[j?.name,"'s Progress"]}),e.jsx("p",{className:"hidden text-xs text-gray-500 sm:text-sm md:block md:text-base",children:"You can close this popup and start tracking your progress."})]}),e.jsxs("p",{className:"-mx-4 mb-3 flex items-center justify-start border-b border-t px-4 py-2 text-sm sm:hidden",children:[e.jsxs("span",{className:"mr-2.5 block rounded-xs bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:u}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:r})," of ",e.jsx("span",{children:i})," done"]})]}),e.jsxs("p",{className:`-mx-4 mb-3 hidden items-center justify-center border-b border-t py-2 text-sm sm:flex ${a?"striped-loader":""}`,children:[e.jsxs("span",{className:"mr-2.5 block rounded-xs bg-yellow-200 px-1 py-0.5 text-xs font-medium uppercase text-yellow-900",children:[e.jsx("span",{children:u}),"% Done"]}),e.jsxs("span",{children:[e.jsx("span",{children:r})," completed"]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:b})," in progress"]}),m>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:m})," skipped"]})]}),e.jsx("span",{className:"mx-1.5 text-gray-400",children:"·"}),e.jsxs("span",{children:[e.jsx("span",{children:i})," Total"]})]})]})}function fe(g){const{resourceId:a,resourceType:n,userId:j,onClose:l,renderer:i="balsamiq"}=g,{s:r=j}=J();if(!r)return null;const m=o.useRef(null),u=o.useRef(null),b=O(),[P,M]=o.useState(!!r),[R,U]=o.useState(null),[$,I]=o.useState(),[y,E]=o.useState(!0),[k,w]=o.useState("");let x="https://roadmap.sh";n==="roadmap"&&i==="balsamiq"?x+=`/${a}.json`:n==="roadmap"&&i==="editor"?x=`https://api.roadmap.sh/v1-official-roadmap/${a}`:x+=`/best-practices/${a}.json`;async function q(s,c,p){const{error:d,response:f}=await v(`https://api.roadmap.sh/v1-get-user-progress/${s}?resourceType=${c}&resourceId=${p}`);if(d||!f)throw d||new Error("Something went wrong. Please try again!");return f}async function C(s,c="balsamiq"){const{error:p,response:d}=await v(s);if(p||!d)throw p||new Error("Something went wrong. Please try again!");return c==="editor"?await G():await A(d,{fontURL:"/fonts/balsamiq.woff2"})}function N(){L("s"),w(""),M(!1),l?l():window.location.reload()}return H("Escape",()=>{N()}),D(u,()=>{N()}),o.useEffect(()=>{!x||!a||!n||!r||(E(!0),w(""),Promise.all([C(x,i),q(r,n,a)]).then(([s,c])=>{if(!c||!s)return;const{progress:p}=c,{done:d,learning:f,skipped:T}=p||{done:[],learning:[],skipped:[]};d?.forEach(t=>{S(t,s).forEach(h=>{h.classList.add("done")})}),f?.forEach(t=>{S(t,s).forEach(h=>{h.classList.add("learning")})}),T?.forEach(t=>{S(t,s).forEach(h=>{h.classList.add("skipped")})}),s.querySelectorAll(".clickable-group").forEach(t=>{t.classList.remove("clickable-group")}),s.querySelectorAll("[data-group-id]").forEach(t=>{t.removeAttribute("data-group-id")}),U(s),I(c)}).catch(s=>{w(s?.message||"Something went wrong. Please try again!")}).finally(()=>{E(!1)}))},[r]),b?.id===r?(L("s"),null):P?y||k?e.jsx(F,{text:"Loading user progress..",isLoading:y,error:k}):e.jsx("div",{id:"user-progress-modal",className:"fixed left-0 right-0 top-0 z-100 h-full items-center justify-center overflow-y-auto overflow-x-hidden overscroll-contain bg-black/50",children:e.jsx("div",{className:"relative mx-auto h-full w-full max-w-4xl p-4 md:h-auto",children:e.jsxs("div",{ref:u,className:"popup-body relative rounded-lg bg-white pt-[1px] shadow-sm",children:[e.jsx(z,{isLoading:y,progressResponse:$}),e.jsx("div",{ref:m,className:"px-4 pb-2",dangerouslySetInnerHTML:{__html:R?.outerHTML||""}}),e.jsxs("button",{type:"button",className:"absolute right-2.5 top-3 ml-auto inline-flex items-center rounded-lg bg-gray-100 bg-transparent p-1.5 text-sm text-gray-400 hover:text-gray-900 lg:hidden",onClick:N,children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]})})}):null}export{fe as UserProgressModal};
