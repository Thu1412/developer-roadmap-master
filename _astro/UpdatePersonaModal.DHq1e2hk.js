import{c as L}from"./createLucideIcon.uNyFMN5K.js";import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{P as Z,a as ee,b as te}from"./Popover.BEqRNE7W.js";import{r as n}from"./index.DatCARk7.js";import{Q as se,b as re,u as q}from"./useQuery.BDS8a8wn.js";import{l as Q,m as ae,o as oe,q as A,a as j}from"./query-client.BXTfwa3d.js";import{h as R,a as W,b as ne}from"./query-http.YhxTqNi8.js";import{i as F}from"./jwt.1xGNZsvU.js";import"./markdown.BXNIcYB9.js";/* empty css                                 */import"./index.Cfv66hal.js";import{c as N}from"./classname.y9b8gBZq.js";import{u as ie}from"./use-copy-text.DMdbdIxo.js";import{T as le}from"./Tooltip.BP6rWEsy.js";import{C as ce}from"./check.DCsIB_xO.js";import{C as de}from"./copy.IVh-7Rp7.js";import{M as J}from"./Modal.B1RqXaQs.js";import{u as U}from"./useMutation.BrRqCquH.js";import{u as G}from"./use-toast.BdCcSTJE.js";import{s as X}from"./popup.CdCAhVM2.js";import{L as M}from"./loader-circle.1OH4z0ap.js";import{M as _}from"./message-circle.gi35PKdE.js";import"./ai.CwFQCDSa.js";import"./js.cookie.Cz0CWeBA.js";import"./roadmap.DwTTnFhR.js";import{D as B}from"./datetime.BHfGb2kO.js";import{D as ue,a as me,b as he,c as V}from"./DropdownMenu.CS77xgrA.js";import{E as ge}from"./ellipsis-vertical.CxxBP93e.js";import{T as xe}from"./trash-2.B2o931ei.js";import{u as pe}from"./use-debounce.2NG_dkht.js";import{S as fe}from"./search.D49NcfKq.js";import{X as Y}from"./x.ZVxf9pxD.js";import{b as ye}from"./billing.CdvAGjKR.js";import{C as $}from"./CheckIcon.D4OhQ5l1.js";import{L as be}from"./lock.C0iyFeE_.js";import{r as je}from"./roadmap.C9m-s_nC.js";import{C as ve}from"./chevron-down.C3HM4CLF.js";import{S as Ne}from"./Spinner.CPY-6wbR.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],St=L("circle-pause",we);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],ke=L("history",Ce);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Pe=L("rotate-cw",Se);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6",key:"y09zxi"}],["path",{d:"m21 3-9 9",key:"mpx6sq"}],["path",{d:"M15 3h6v6",key:"1q9fwt"}]],Pt=L("square-arrow-out-up-right",Ie);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],De=L("trash",Fe);var Me=class extends se{constructor(s,t){super(s,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:Q()})}getOptimisticResult(s){return s.behavior=Q(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,t){const{state:a}=s,o=super.createResult(s,t),{isFetching:c,isRefetching:i,isError:l,isRefetchError:m}=o,u=a.fetchMeta?.fetchMore?.direction,h=l&&u==="forward",d=c&&u==="forward",v=l&&u==="backward",g=c&&u==="backward";return{...o,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:oe(t,a.data),hasPreviousPage:ae(t,a.data),isFetchNextPageError:h,isFetchingNextPage:d,isFetchPreviousPageError:v,isFetchingPreviousPage:g,isRefetchError:m&&!h&&!v,isRefetching:i&&!d&&!g}}};function Oe(s,t){return re(s,Me,t)}n.memo(s=>{const{chatHistory:t,onDelete:a,isStreamingMessage:o,streamedMessage:c,onRegenerate:i}=s;return e.jsx("div",{className:"flex grow flex-col",children:e.jsx("div",{className:"relative flex grow flex-col justify-end",children:e.jsxs("div",{className:"flex grow flex-col justify-end gap-14 py-5",children:[t.map((l,m)=>e.jsx(n.Fragment,{children:e.jsx(T,{...l,onDelete:()=>{a?.(m)},onRegenerate:()=>{i?.(m)}})},`chat-${m}`)),o&&!c&&e.jsx(T,{role:"assistant",content:"",html:"<p>Thinking...</p>",showActions:!1}),c&&e.jsx(T,{role:"assistant",content:"",jsx:c,showActions:!1})]})})})});const T=n.memo(s=>{const{role:t,content:a,jsx:o,html:c,showActions:i=!0,onDelete:l,onRegenerate:m}=s,{copyText:u,isCopied:h}=ie();return e.jsxs("div",{className:N("group/content relative flex w-full flex-col",t==="user"?"items-end":"items-start"),children:[e.jsxs("div",{className:N("flex max-w-full items-start gap-2.5 rounded-lg",t==="user"?"max-w-[70%] bg-gray-200 p-3":"w-full"),children:[!!o&&o,!!c&&e.jsx("div",{className:"course-content course-ai-content prose prose-sm overflow-hidden text-sm",dangerouslySetInnerHTML:{__html:c}})]}),i&&e.jsxs("div",{className:N("absolute -bottom-2 flex translate-y-full items-center gap-1",t==="user"?"right-0":"left-0"),children:[e.jsx(E,{icon:h?ce:de,onClick:()=>u(a??""),tooltip:h?"Copied":"Copy"}),t==="assistant"&&m&&e.jsx(E,{icon:Pe,onClick:m,tooltip:"Regenerate"}),l&&e.jsx(E,{icon:De,onClick:l,tooltip:"Delete"})]})]})});function E(s){const{icon:t,onClick:a,tooltip:o}=s;return e.jsxs("div",{className:"group relative",children:[e.jsx("button",{className:"flex size-8 items-center justify-center rounded-lg opacity-0 transition-opacity group-hover/content:opacity-100 hover:bg-gray-200",onClick:a,children:e.jsx(t,{className:"size-4 stroke-[2.5]"})}),o&&e.jsx(le,{position:"top-center",additionalClass:"-translate-y-1",children:o})]})}function z(s){const{className:t,children:a,...o}=s;return e.jsxs("div",{className:"relative flex",children:[e.jsx("select",{"data-slot":"select-native",className:N("peer inline-flex w-full cursor-pointer appearance-none items-center rounded-lg border border-gray-200 text-sm text-black outline-none focus-visible:border-gray-500 disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 has-[option[disabled]:checked]:text-gray-500 aria-invalid:border-red-500 aria-invalid:ring-red-500/20 dark:aria-invalid:ring-red-500/40",s.multiple?"[&_option:checked]:bg-accent py-1 *:px-3 *:py-1":"h-9 ps-3 pe-8",t),...o,children:a}),!s.multiple&&e.jsx("span",{className:"pointer-events-none absolute inset-y-0 end-0 flex h-full w-9 items-center justify-center text-gray-500/80 peer-disabled:opacity-50 peer-aria-invalid:text-red-500/80",children:e.jsx(ve,{size:16,"aria-hidden":"true"})})]})}function K(s){return A({queryKey:["user-persona",s],queryFn:async()=>R(`/v1-user-roadmap-persona/${s}`),enabled:!!s&&F(),refetchOnMount:!1})}function Le(){return A({queryKey:["user-persona"],queryFn:async()=>R("/v1-user-persona"),enabled:!!F(),refetchOnMount:!1})}n.memo(s=>{const{defaultValues:t,onClose:a}=s,o=G(),[c,i]=n.useState(t?.expertise??""),[l,m]=n.useState(t?.about??""),[u,h]=n.useState(t?.specialInstructions??""),d=["Finding a job","Learning for fun","Building a side project","Switching careers","Getting a promotion","Filling knowledge gaps","Other"],v=()=>{if(!t?.goal)return"";for(const r of d.slice(0,-1))if(t.goal.startsWith(r))return r;return"Other"},[g,w]=n.useState(v()),[f,p]=n.useState(t?.goal??""),y=n.useId(),O=n.useId(),S=n.useId(),C=n.useId(),P=n.useId(),k=n.useRef(null),D=r=>{w(r),r==="Other"?(p(""),setTimeout(()=>{k.current?.focus()},0)):p(r)},{mutate:x,isPending:b}=U({mutationFn:r=>W("/v1-set-chat-preferences",r),onSuccess:()=>{a(),j.invalidateQueries(Le())},onError:r=>{o.error(r?.message??"Something went wrong")}},j),I=r=>{if(r.preventDefault(),!F()){X();return}x({expertise:c,goal:f,about:l,specialInstructions:u})},H=!!c&&!!f&&!!l;return e.jsx(J,{onClose:a,children:e.jsx("div",{className:"p-4",children:e.jsxs("form",{onSubmit:I,className:N("space-y-8"),children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:y,children:"Rate your Experience"}),e.jsxs(z,{id:y,value:c,defaultValue:c,onChange:r=>i(r.target.value),className:"h-[40px] border-gray-300 text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500",children:[e.jsx("option",{value:"",children:"Select your expertise"}),["No experience (just starting out)","Beginner (less than 1 year of experience)","Intermediate (1-3 years of experience)","Expert (3-5 years of experience)","Master (5+ years of experience)"].map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:S,children:"What is your goal?"}),e.jsxs(z,{id:S,value:g,onChange:r=>D(r.target.value),className:"h-[40px] border-gray-300 text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500",children:[e.jsx("option",{value:"",children:"Select your goal"}),d.map(r=>e.jsx("option",{value:r,children:r},r))]}),g==="Other"&&e.jsx("textarea",{ref:k,id:O,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. need to find a job as soon as possible",value:f,onChange:r=>p(r.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:C,children:"Tell us more about yourself"}),e.jsx("textarea",{id:C,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. I'm a software engineer with 5 years of experience",value:l,onChange:r=>m(r.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:P,children:"Special Instructions"}),e.jsx("textarea",{id:P,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. Prefer concise responses with code examples",value:u,onChange:r=>h(r.target.value)})]}),e.jsx("button",{disabled:!H||b,type:"submit",className:"mt-6 flex h-11 w-full items-center justify-center gap-2 rounded-lg bg-black px-6 py-2 text-sm text-white transition-all hover:bg-gray-900 disabled:pointer-events-none disabled:opacity-50",children:b?e.jsx(M,{className:"size-4 animate-spin stroke-[2.5]"}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"size-4"}),t?"Update Preferences":"Set Preferences"]})})]})})})});function It(s){return A({queryKey:["chat-history-details",s],queryFn:async()=>{const t=await R(`/v1-chat-history/${s}`);return t.title&&(document.title=t.title),t},enabled:!!F()&&!!s})}function ze(s={query:"",roadmapId:""}){return{queryKey:["list-chat-history",s],queryFn:({pageParam:t})=>R("/v1-list-chat-history",{...s?.query?{query:s.query}:{},...s?.roadmapId?{roadmapId:s.roadmapId}:{},...t?{currPage:t}:{},perPage:"21"}),enabled:!!F(),getNextPageParam:(t,a)=>t.currPage<t.totalPages?t.currPage+1:void 0,initialPageParam:1}}function Re(s){const t=B.now().startOf("day");return s?.reduce((a,o)=>{const c=B.fromJSDate(new Date(o.updatedAt)).startOf("day"),i=Math.abs(c.diff(t,"days").days);return i===0?a.today.histories.push(o):i<=7?a.last7Days.histories.push(o):a.older.histories.push(o),a},{today:{title:"Today",histories:[]},last7Days:{title:"Last 7 Days",histories:[]},older:{title:"Older",histories:[]}})}function He(s){const{chatHistoryId:t,onDelete:a}=s,o=G(),[c,i]=n.useState(!1),[l,m]=n.useState(!1),{mutate:u,isPending:h}=U({mutationFn:d=>ne(`/v1-delete-chat/${d}`),onSettled:()=>j.invalidateQueries({predicate:d=>d.queryKey[0]==="list-chat-history"}),onSuccess:()=>{o.success("Chat history deleted"),i(!1),a?.()},onError:d=>{o.error(d?.message||"Failed to delete chat history")}},j);return e.jsxs(ue,{open:c,onOpenChange:i,children:[e.jsx(me,{className:"rounded-lg p-2 opacity-0 group-hover/item:opacity-100 hover:bg-gray-100 focus:outline-none data-[state=open]:bg-gray-100 data-[state=open]:opacity-100",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsxs(he,{align:"end",className:"z-[9999]",children:[!l&&e.jsx(V,{className:"cursor-pointer text-red-500 focus:bg-red-50 focus:text-red-500",onSelect:d=>{d.preventDefault(),m(!0)},disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),"Deleting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4"}),"Delete"]})}),l&&e.jsx(V,{asChild:!0,className:"focus:bg-transparent",onSelect:d=>{d.preventDefault()},disabled:h,children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-1.5",children:["Are you sure?",e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{u(t),m(!1)},className:"cursor-pointer text-red-500 underline hover:text-red-800",disabled:h,children:"Yes"}),e.jsx("button",{onClick:()=>m(!1),className:"cursor-pointer text-red-500 underline hover:text-red-800",disabled:h,children:"No"})]})]})})]})]})}function Te(s){const{chatHistory:t,isActive:a,onChatHistoryClick:o,onDelete:c}=s;return e.jsxs("li",{className:"group/item relative text-sm",children:[e.jsx("button",{className:"block w-full truncate rounded-lg p-2 pr-10 text-left hover:bg-gray-100 data-[active=true]:bg-gray-100","data-active":a,onClick:()=>o(t._id),children:t.title}),e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center",children:e.jsx(He,{chatHistoryId:t._id,onDelete:c})})]},t._id)}function Ee(s){const{title:t,histories:a,activeChatHistoryId:o,onChatHistoryClick:c,onDelete:i}=s;return e.jsxs("div",{children:[e.jsx("h2",{className:"ml-2 text-xs text-gray-500",children:t}),e.jsx("ul",{className:"mt-1 space-y-0.5",children:a.map(l=>e.jsx(Te,{chatHistory:l,isActive:o===l._id,onChatHistoryClick:c,onDelete:()=>{i?.(l._id)}},l._id))})]})}function qe(s){const{onSearch:t,isLoading:a,className:o,inputClassName:c}=s,[i,l]=n.useState(""),m=pe(i,300);return n.useEffect(()=>{t(m)},[m,t]),e.jsxs("form",{className:N("relative mt-2 flex grow items-center",o),onSubmit:u=>{u.preventDefault(),t(i)},children:[e.jsx("input",{type:"text",placeholder:"Search folder by name",className:N("block h-9 w-full rounded-lg border border-gray-200 bg-white px-3 py-2 pr-7 pl-8 text-sm outline-none placeholder:text-zinc-500 focus:border-zinc-500",c),required:!0,minLength:3,maxLength:255,value:i,"data-clarity-unmask":"true",onChange:u=>l(u.target.value)}),e.jsx("div",{className:"absolute top-1/2 left-2.5 -translate-y-1/2",children:a?e.jsx(M,{className:"size-4 animate-spin text-gray-500"}):e.jsx(fe,{className:"size-4 text-gray-500"})}),i&&e.jsx("div",{className:"absolute inset-y-0 right-1 flex items-center",children:e.jsx("button",{onClick:()=>{l("")},className:"rounded-lg p-1 hover:bg-gray-100",children:e.jsx(Y,{className:"size-4 text-gray-500"})})})]})}function _e(s){const{className:t,onUpgrade:a,closeButton:o}=s;return e.jsxs("div",{className:N("relative flex flex-col",t),children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:o}),e.jsxs("div",{className:"flex grow flex-col items-center justify-center px-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"mb-3 rounded-full bg-yellow-100 p-3",children:e.jsx(be,{className:"size-6 text-yellow-600"})}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Unlock History"}),e.jsx("p",{className:"mt-2 text-center text-sm text-balance text-gray-600",children:"Save conversations and pick up right where you left off."})]}),e.jsxs("div",{className:"my-5 w-full space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2",children:[e.jsx($,{additionalClasses:"size-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Unlimited history"})]}),e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2",children:[e.jsx($,{additionalClasses:"size-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Search old chats"})]})]}),e.jsx("button",{type:"button",className:"w-full cursor-pointer rounded-lg bg-yellow-400 px-4 py-2 text-sm font-medium text-black hover:bg-yellow-500",onClick:()=>{a?.()},children:"Upgrade to Pro"})]})]})}function Ft(s){const{roadmapId:t,activeChatHistoryId:a,activeChatHistoryTitle:o,onChatHistoryClick:c,onDelete:i,onUpgrade:l}=s,[m,u]=n.useState(!1),[h,d]=n.useState(!0),[v,g]=n.useState(""),{data:w,isLoading:f}=q(ye(),j),p=w?.status==="active",{data:y,hasNextPage:O,fetchNextPage:S,isFetchingNextPage:C,isLoading:P}=Oe({...ze({roadmapId:t,query:v}),enabled:!!t&&F()&&m&&p},j);n.useEffect(()=>{p||d(!1)},[p]),n.useEffect(()=>{!y||f||d(!1)},[y,f]);const k=n.useMemo(()=>{const x=y?.pages?.flatMap(b=>b.data);return Re(x??[])},[y?.pages]),D=Object.values(k??{}).every(x=>x.histories.length===0);return e.jsxs(Z,{open:m,onOpenChange:x=>{if(!F()){X();return}u(x)},children:[e.jsxs(ee,{className:"flex items-center justify-center gap-2 rounded-md bg-gray-200 px-3 py-1.5 text-xs text-gray-900 hover:bg-gray-300 hover:text-black",children:[e.jsx(ke,{className:"size-3.5"}),o||"Chat History"]}),e.jsxs(te,{className:"z-[999] flex max-h-[400px] w-80 flex-col overflow-hidden p-0 shadow-lg",align:"end",sideOffset:4,children:[h&&e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(M,{className:"size-6 animate-spin stroke-[2.5] text-gray-400"})}),!h&&!p&&e.jsx(_e,{className:"mt-0 px-10 py-10",onUpgrade:()=>{u(!1),l?.()}}),!h&&p&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{onSearch:g,isLoading:P,className:"mt-0",inputClassName:"border-x-0 border-t-0 border-b border-b-gray-200 rounded-none focus:border-b-gray-200"}),e.jsxs("div",{className:"scrollbar-track-transparent scrollbar-thin scrollbar-thumb-gray-300 grow space-y-4 overflow-y-auto p-2 pt-4",children:[D&&e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No chat history"})}),Object.entries(k??{}).map(([x,b])=>b.histories.length===0?null:e.jsx(Ee,{title:b.title,histories:b.histories,activeChatHistoryId:a,onChatHistoryClick:I=>{u(!1),c(I)},onDelete:I=>{u(!1),i?.(I)}},x)),O&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{className:"flex w-full items-center justify-center gap-2 text-sm text-gray-500 hover:text-black",onClick:()=>{S()},disabled:C,children:[C&&e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),"Loading more..."]}),!C&&"Load More"]})})]})]})]})]})}function Ae(s){const{roadmapTitle:t,defaultValues:a,className:o="",onSubmit:c,isLoading:i}=s,[l,m]=n.useState(a?.expertise??""),u=["Finding a job","Learning for fun","Building a side project","Switching careers","Getting a promotion","Filling knowledge gaps","Other"],h=()=>{if(!a?.goal)return"";for(const r of u.slice(0,-1))if(a.goal.startsWith(r))return r;return"Other"},[d,v]=n.useState(h()),[g,w]=n.useState(a?.goal??""),[f,p]=n.useState(a?.commit??""),[y,O]=n.useState(a?.about??""),S=n.useId(),C=n.useId(),P=n.useId(),k=n.useId(),D=n.useId(),x=n.useRef(null),b=r=>{v(r),r==="Other"?(w(""),setTimeout(()=>{x.current?.focus()},0)):w(r)},I=r=>{r.preventDefault(),c({expertise:l,goal:g,commit:f,about:y})},H=!!l&&!!g&&!!f;return e.jsxs("form",{onSubmit:I,className:N("space-y-5",o),children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700",htmlFor:S,children:["Rate your expertise in ",t,":"]}),e.jsxs(z,{id:S,value:l,defaultValue:l,onChange:r=>m(r.target.value),className:"h-[40px] border-gray-300 text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500",children:[e.jsx("option",{value:"",children:"Select your expertise"}),["No experience (just starting out)","Beginner (less than 1 year of experience)","Intermediate (1-3 years of experience)","Expert (3-5 years of experience)","Master (5+ years of experience)"].map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:P,children:"What is your goal?"}),e.jsxs(z,{id:P,value:d,onChange:r=>b(r.target.value),className:"h-[40px] border-gray-300 text-sm focus:border-gray-500 focus:ring-1 focus:ring-gray-500",children:[e.jsx("option",{value:"",children:"Select your goal"}),u.map(r=>e.jsx("option",{value:r,children:r},r))]}),d==="Other"&&e.jsx("textarea",{ref:x,id:C,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. need to find a job as soon as possible",value:g,onChange:r=>w(r.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:k,children:"How many hours per week can you commit to learning?"}),e.jsx("input",{id:k,className:"block h-[40px] w-full resize-none rounded-lg border border-gray-300 bg-white px-4 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. 10 hours per week",value:f,onChange:r=>p(r.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:D,children:"Tell us about yourself (optional but recommended)"}),e.jsx("textarea",{id:D,className:"block min-h-24 w-full resize-none rounded-lg border border-gray-300 bg-white px-4 py-3 text-sm outline-none placeholder:text-gray-400 focus:border-gray-500 focus:ring-1 focus:ring-gray-500",placeholder:"e.g. I'm a frontend developer with experience in React, looking to expand my backend skills...",value:y,onChange:r=>O(r.target.value)})]}),e.jsx("button",{disabled:i||!H,type:"submit",className:"mt-6 flex h-11 w-full items-center justify-center gap-2 rounded-lg bg-black px-6 py-2 text-sm text-white transition-all hover:bg-gray-900 disabled:pointer-events-none disabled:opacity-50",children:i?e.jsx(M,{className:"size-4 animate-spin stroke-[2.5]"}):e.jsx(e.Fragment,{children:a?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"size-4"}),"Update Information"]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"size-4"}),"Start Chatting"]})})})]})}function Dt(s){const{roadmapId:t,onClose:a}=s,o=G(),{data:c}=q(je(t),j),{data:i,isLoading:l}=q(K(t),j),{mutate:m,isPending:u}=U({mutationFn:async d=>W("/v1-set-user-persona",{...d,roadmapId:t}),onError:d=>{o.error(d?.message||"Something went wrong")},onSuccess:()=>{a()},onSettled:()=>j.invalidateQueries(K(t))},j),h=c?.json.title??"";return e.jsxs(J,{onClose:a,wrapperClassName:"max-w-[450px]",bodyClassName:"p-4",children:[e.jsx("button",{onClick:a,className:"absolute top-2.5 right-2.5 inline-flex items-center rounded-lg bg-transparent p-1.5 text-sm text-gray-400 hover:bg-gray-200 hover:text-gray-900",children:e.jsx(Y,{className:"h-5 w-5"})}),l&&e.jsxs("div",{className:"absolute inset-0 z-50 flex h-full flex-row items-center justify-center gap-3 bg-white",children:[e.jsx(Ne,{isDualRing:!1,className:"h-4 w-4"}),e.jsx("p",{className:"text-base text-gray-500",children:"Loading..."})]}),e.jsxs("div",{className:"mb-4 text-left",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Tell us more about yourself"}),e.jsx("p",{className:"mt-1 text-sm text-balance text-gray-500",children:"We'll use this information to help you get the best out of the AI Tutor."})]}),e.jsx(Ae,{className:"space-y-4",roadmapTitle:h,defaultValues:{expertise:i?.expertise??"",goal:i?.goal??"",commit:i?.commit??"",about:i?.about??""},onSubmit:d=>{if(!d?.goal?.trim()){o.error("Please describe your goal");return}if(!d?.commit?.trim()){o.error("Please enter how many hours per week you can commit to learning");return}m(d)},isLoading:u},i?"loaded":"loading")]})}export{St as C,ke as H,Ft as R,Pt as S,Dt as U,Ae as a,It as c,K as u};
